<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css">


    <!-- Custom CSS -->
    
<style type="text/css">
body {
    background-image:  url('static/img/background.jpg')
}
button {
    background: #428BCA;
    color: #fff;
    font-family: Sans-serif;
    font-size: 20px;
    border-radius: 45px;
    height: 60px;
    width: 150px;
    line-height: 60px;
    margin: 25px 25px;
    text-align: center;
    border: 0;
    transition: all 0.3s ease 0s;

}
button:hover {
  background: #3071A9;

}
    

#second {
    background: rgba(0,0,0,0);
    width:100%;
    color: #ffffff;
    height: 45vw;
    padding-left: 10vw;
    padding-right: 10vw;
    border-top: 55px;
    font-family:Arial, Helvetica, sans-serif;
        font-size:50px;

    line-height:1.5em;
}
#read_content{
    height:50%
}
#first {
    width: 100%;
    
  
}


</style>


<body>
<div id="first">
    <button id="button2">Start</button>
</div>
<div id="second">
        
        
        <button class="record">Record </button>
        <button class="next">Submit & Next</button><br>
        <div id="read_content"></div>
        <button class="stop">Stop</button>
</div>

<article class="sound-clips"></article>

<script src='static/js/jquery.min.js'></script>
<script src="static/js/bootstrap.min.js"></script>



<script type="text/javascript">
    
    var content = "{{wiki_content}}";
    var content_array = content.split("");
    var loopTimer;
    function animation_function() {
        if(content_array.length > 0) {
            document.getElementById("read_content").innerHTML += content_array.shift();
        } else {
            clearTimeout(loopTimer); 
            return false;
        }
        loopTimer = setTimeout('animation_function()',70);
    }
    

    $(document).ready(function() {
       
        $("#second").hide();
    });


    $("#button2").click(function(){
        $("#first").hide();
        $("#second").show();
        
        
    });

    $(".next").click(function(){
        window.location.reload();
        
    });



navigator.getUserMedia = navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia;
var record = document.querySelector('.record');
var stop = document.querySelector('.stop');


var soundClips = document.querySelector('.sound-clips');

if (navigator.getUserMedia) {
   console.log('getUserMedia supported.');
   navigator.getUserMedia (
      // constraints - only audio needed for this app
      {
         audio: true
      },

      // Success callback
      function(stream) {
            var mediaRecorder = new MediaRecorder(stream);
            record.onclick = function()
                     {
                animation_function()
                  mediaRecorder.start();
                  console.log(mediaRecorder.state);
                  console.log("recorder started");
                  record.style.background = "red";
                  record.style.color = "black";
                    }

            var chunks = [];

            mediaRecorder.ondataavailable = function(e) {
                chunks.push(e.data);
}
            stop.onclick = function() {
                  mediaRecorder.stop();
                  console.log(mediaRecorder.state);
                  console.log("recorder stopped");
                  record.style.background = "";
                  record.style.color = "";
                }  

            mediaRecorder.onstop = function(e) {
  console.log("recorder stopped");

  var clipName = prompt('Enter a name for your sound clip');

  var clipContainer = document.createElement('article');
  var clipLabel = document.createElement('p');
  var audio = document.createElement('audio');
  var deleteButton = document.createElement('button');
           
  clipContainer.classList.add('clip');
  audio.setAttribute('controls', '');
  deleteButton.innerHTML = "Delete";
  clipLabel.innerHTML = clipName;

  clipContainer.appendChild(audio);
  clipContainer.appendChild(clipLabel);
  clipContainer.appendChild(deleteButton);
  soundClips.appendChild(clipContainer);

  var blob = new Blob(chunks, { 'type' : 'audio/ogg; codecs=opus' });
  chunks = [];
  var audioURL = window.URL.createObjectURL(blob);
  audio.src = audioURL;

  deleteButton.onclick = function(e) {
    evtTgt = e.target;
    evtTgt.parentNode.parentNode.removeChild(evtTgt.parentNode);
  }

}             
      },

      // Error callback
      function(err) {
         console.log('The following gUM error occured: ' + err);
      }
   );
} else {
   console.log('getUserMedia not supported on your browser!');
}
</script>
    
</body>

</html>